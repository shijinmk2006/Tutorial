Dictionary<OffCycleFilter, int> GetOffCycleFilterColumns(Worksheet worksheet)
{
    // Get off cycle filter columns from database
    Dictionary<string, OffCycleFilter> offCycleFilterColumnNames = new()
    {
        { "Payment Date".Trim().ToUpper(), OffCycleFilter.PayrollPayDate },
        { "Run Date".Trim().ToUpper(), OffCycleFilter.PeriodEndDate },
        { "Consolidation Set".Trim().ToUpper(), OffCycleFilter.PayCycle }
    };

    Dictionary<OffCycleFilter, int> offCycleFilterColumns = new();

    for (int i = 0; i <= worksheet.Cells.MaxDataColumn; i++)
    {
        if (offCycleFilterColumns.Count == offCycleFilterColumnNames.Count)
            break;

        string header = worksheet.Cells[0, i].StringValue.Trim().ToUpper();

        if (string.IsNullOrWhiteSpace(header))
            continue;

        if (offCycleFilterColumnNames.TryGetValue(header, out OffCycleFilter offCycleFilter) &&
            !offCycleFilterColumns.ContainsKey(offCycleFilter))
            offCycleFilterColumns.Add(offCycleFilter, i);
    }

    return offCycleFilterColumns;
}
public enum OffCycleFilter
{
    PayrollPayDate,
    PeriodEndDate,
    ProcessEndDate,
    PayCycle
}


// Use linq to query the worksheet cells and get the matching column indices
return worksheet.Cells[0, 0, 0, worksheet.Cells.MaxDataColumn]
    .Where(c => !string.IsNullOrWhiteSpace(c.StringValue))
    .Select(c => new { Header = c.StringValue.Trim().ToUpper(), Column = c.Column })
    .Join(offCycleFilterColumnNames, c => c.Header, kvp => kvp.Key, (c, kvp) => new { OffCycleFilter = kvp.Value, Column = c.Column })
    .ToDictionary(x => x.OffCycleFilter, x => x.Column);

